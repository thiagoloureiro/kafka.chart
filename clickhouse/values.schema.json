{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "ClickHouse Helm Chart Values",
  "description": "Schema for ClickHouse Helm chart values",
  "properties": {
    "global": {
      "type": "object",
      "description": "Global settings that can be used by parent charts or overrides",
      "additionalProperties": true
    },
    "timezone": {
      "type": "string",
      "description": "Timezone",
      "default": "UTC"
    },
    "clusterDomain": {
      "type": "string",
      "description": "Cluster domain",
      "default": "cluster.local"
    },
    "nodeSelector": {
      "type": "object",
      "description": "Node selectors for pod assignment",
      "additionalProperties": {
        "type": "string"
      }
    },
    "tolerations": {
      "type": "array",
      "description": "Tolerations for pod assignment",
      "items": {
        "type": "object"
      }
    },
    "affinity": {
      "type": "object",
      "description": "Pod/node affinity/anti-affinity",
      "additionalProperties": true
    },
    "serviceAccount": {
      "type": "object",
      "description": "Service Account configuration",
      "properties": {
        "annotations": {
          "type": "object",
          "description": "Additional Service Account annotations",
          "additionalProperties": {
            "type": "string"
          }
        },
        "enabled": {
          "type": "boolean",
          "description": "If true, a custom Service Account will be used",
          "default": false
        },
        "name": {
          "type": "string",
          "description": "The name of the ServiceAccount to use",
          "default": "clickhouse"
        },
        "automountServiceAccountToken": {
          "type": "boolean",
          "description": "Automount API credentials for a Service Account",
          "default": true
        }
      }
    },
    "clickhouse": {
      "type": "object",
      "description": "ClickHouse configuration",
      "properties": {
        "podManagementPolicy": {
          "type": "string",
          "description": "StatefulSet pod management policy",
          "enum": ["OrderedReady", "Parallel"],
          "default": "Parallel"
        },
        "updateStrategy": {
          "type": "string",
          "description": "StatefulSet update strategy",
          "enum": ["RollingUpdate", "OnDelete"],
          "default": "RollingUpdate"
        },
        "rollingUpdatePartition": {
          "type": ["integer", "null"],
          "description": "Partition update strategy"
        },
        "podSecurityContext": {
          "type": "object",
          "description": "Pod Security Context",
          "additionalProperties": true
        },
        "securityContext": {
          "type": "object",
          "description": "Security Context",
          "additionalProperties": true
        },
        "volumes": {
          "type": "array",
          "description": "Additional Volumes",
          "items": {
            "type": "object"
          }
        },
        "volumeMounts": {
          "type": "array",
          "description": "Additional Volume Mounts",
          "items": {
            "type": "object"
          }
        },
        "metrics": {
          "type": "object",
          "description": "Prometheus Exporter / Metrics configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "port": {
              "type": "integer",
              "default": 9116
            },
            "podAnnotations": {
              "type": "object",
              "description": "Metrics exporter pod Annotation and Labels",
              "additionalProperties": {
                "type": "string"
              }
            },
            "serviceMonitor": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "namespace": {
                  "type": "string"
                },
                "interval": {
                  "type": "string"
                },
                "selector": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  }
                }
              }
            },
            "prometheusRule": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "additionalLabels": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  }
                },
                "namespace": {
                  "type": "string"
                },
                "rules": {
                  "type": "array",
                  "items": {
                    "type": "object"
                  }
                }
              }
            },
            "service": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "default": "ClusterIP"
                },
                "loadBalancerIP": {
                  "type": "string"
                },
                "annotations": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  }
                },
                "labels": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "path": {
          "type": "string",
          "description": "The path to the directory containing data",
          "default": "/var/lib/clickhouse"
        },
        "listen_host": {
          "type": "string",
          "description": "The host to listen on",
          "default": "0.0.0.0"
        },
        "http_port": {
          "type": "string",
          "description": "The port for connecting to the server over HTTP",
          "default": "8123"
        },
        "tcp_port": {
          "type": "string",
          "description": "Port for communicating with clients over the TCP protocol",
          "default": "9000"
        },
        "interserver_http_port": {
          "type": "string",
          "description": "Port for exchanging data between ClickHouse servers",
          "default": "9009"
        },
        "replicas": {
          "type": "string",
          "description": "The instance number of Clickhouse",
          "default": "3"
        },
        "image": {
          "type": "string",
          "description": "Clickhouse image configuration",
          "default": "clickhouse/clickhouse-server"
        },
        "imageVersion": {
          "type": "string",
          "description": "Clickhouse image version",
          "default": "25.12"
        },
        "imagePullPolicy": {
          "type": "string",
          "description": "Image pull policy",
          "enum": ["Always", "Never", "IfNotPresent"],
          "default": "IfNotPresent"
        },
        "priorityClassName": {
          "type": ["string", "null"],
          "description": "Priority class name"
        },
        "resources": {
          "type": "object",
          "description": "The resource limits and requests used by clickhouse",
          "additionalProperties": true
        },
        "startupProbe": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "periodSeconds": {
              "type": "integer",
              "default": 5
            },
            "timeoutSeconds": {
              "type": "integer",
              "default": 5
            },
            "failureThreshold": {
              "type": "integer",
              "default": 60
            },
            "successThreshold": {
              "type": "integer",
              "default": 1
            }
          }
        },
        "livenessProbe": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "initialDelaySeconds": {
              "type": "integer",
              "default": 0
            },
            "periodSeconds": {
              "type": "integer",
              "default": 30
            },
            "timeoutSeconds": {
              "type": "integer",
              "default": 5
            },
            "failureThreshold": {
              "type": "integer",
              "default": 3
            },
            "successThreshold": {
              "type": "integer",
              "default": 1
            }
          }
        },
        "readinessProbe": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "initialDelaySeconds": {
              "type": "integer",
              "default": 0
            },
            "periodSeconds": {
              "type": "integer",
              "default": 30
            },
            "timeoutSeconds": {
              "type": "integer",
              "default": 5
            },
            "failureThreshold": {
              "type": "integer",
              "default": 3
            },
            "successThreshold": {
              "type": "integer",
              "default": 1
            }
          }
        },
        "persistentVolumeClaim": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "dataPersistentVolume": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true
                },
                "accessModes": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "default": ["ReadWriteOnce"]
                },
                "storage": {
                  "type": "string",
                  "default": "100Gi"
                }
              }
            },
            "logsPersistentVolume": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "accessModes": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "default": ["ReadWriteOnce"]
                },
                "storage": {
                  "type": "string",
                  "default": "50Gi"
                }
              }
            }
          }
        },
        "ingress": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "host": {
              "type": "string"
            },
            "path": {
              "type": "string",
              "default": "/"
            },
            "tls": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "hosts": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "secretName": {
                  "type": "string"
                }
              }
            }
          }
        },
        "configmap": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "max_connections": {
              "type": "string",
              "default": "4096"
            },
            "keep_alive_timeout": {
              "type": "string",
              "default": "3"
            },
            "max_concurrent_queries": {
              "type": "string",
              "default": "100"
            },
            "uncompressed_cache_size": {
              "type": "string",
              "default": "8589934592"
            },
            "mark_cache_size": {
              "type": "string",
              "default": "5368709120"
            },
            "umask": {
              "type": "string",
              "default": "022"
            },
            "mlock_executable": {
              "type": "boolean",
              "default": false
            },
            "builtin_dictionaries_reload_interval": {
              "type": "string",
              "default": "3600"
            },
            "max_session_timeout": {
              "type": "string",
              "default": "3600"
            },
            "default_session_timeout": {
              "type": "string",
              "default": "60"
            },
            "disable_internal_dns_cache": {
              "type": "string",
              "default": "1"
            },
            "max_server_memory_usage": {
              "type": "string"
            },
            "max_open_files": {
              "type": "integer"
            },
            "interserver_http_host": {
              "type": "string"
            },
            "logger": {
              "type": "object",
              "properties": {
                "path": {
                  "type": "string",
                  "default": "/var/log/clickhouse-server"
                },
                "level": {
                  "type": "string",
                  "enum": ["trace", "debug", "information", "warning", "error"],
                  "default": "error"
                },
                "size": {
                  "type": "string",
                  "default": "1000M"
                },
                "count": {
                  "type": ["integer", "string"],
                  "default": 10
                },
                "stdoutLogsEnabled": {
                  "type": "boolean",
                  "default": false
                }
              }
            },
            "compression": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "cases": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "min_part_size": {
                        "type": "string"
                      },
                      "min_part_size_ratio": {
                        "type": "string"
                      },
                      "method": {
                        "type": "string",
                        "enum": ["lz4", "zstd"]
                      }
                    }
                  }
                }
              }
            },
            "zookeeper_servers": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "session_timeout_ms": {
                  "type": "string",
                  "default": "30000"
                },
                "operation_timeout_ms": {
                  "type": "string",
                  "default": "10000"
                },
                "root": {
                  "type": "string"
                },
                "identity": {
                  "type": "string"
                },
                "config": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "index": {
                        "type": "string"
                      },
                      "host": {
                        "type": "string"
                      },
                      "port": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            },
            "remote_servers": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true
                },
                "internal_replication": {
                  "type": "boolean",
                  "default": false
                },
                "replica": {
                  "type": "object",
                  "properties": {
                    "user": {
                      "type": "string",
                      "default": "default"
                    },
                    "password": {
                      "type": "string"
                    },
                    "compression": {
                      "type": "boolean",
                      "default": true
                    },
                    "backup": {
                      "type": "object",
                      "properties": {
                        "enabled": {
                          "type": "boolean",
                          "default": true
                        }
                      }
                    }
                  }
                }
              }
            },
            "graphite": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "config": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "timeout": {
                        "type": "string"
                      },
                      "interval": {
                        "type": "string"
                      },
                      "root_path": {
                        "type": "string"
                      },
                      "metrics": {
                        "type": "boolean"
                      },
                      "events": {
                        "type": "boolean"
                      },
                      "events_cumulative": {
                        "type": "boolean"
                      },
                      "asynchronous_metrics": {
                        "type": "boolean"
                      }
                    }
                  }
                }
              }
            },
            "profiles": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "profile": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "name": {
                        "type": "string"
                      },
                      "config": {
                        "type": "object",
                        "additionalProperties": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            },
            "users": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true
                },
                "user": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "name": {
                        "type": "string"
                      },
                      "config": {
                        "type": "object",
                        "properties": {
                          "networks": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "profile": {
                            "type": "string"
                          },
                          "quota": {
                            "type": "string"
                          },
                          "password": {
                            "type": "string"
                          }
                        },
                        "additionalProperties": true
                      }
                    }
                  }
                }
              }
            },
            "quotas": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "quota": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "name": {
                        "type": "string"
                      },
                      "config": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "duration": {
                              "type": "string"
                            },
                            "queries": {
                              "type": "string"
                            },
                            "errors": {
                              "type": "string"
                            },
                            "result_rows": {
                              "type": "string"
                            },
                            "read_rows": {
                              "type": "string"
                            },
                            "execution_time": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "merge_tree": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "parts_to_delay_insert": {
                  "type": "integer",
                  "default": 150
                },
                "parts_to_throw_insert": {
                  "type": "integer",
                  "default": 300
                },
                "max_part_loading_threads": {
                  "type": ["string", "integer"],
                  "default": "auto"
                },
                "max_suspicious_broken_parts": {
                  "type": "integer",
                  "default": 100
                }
              }
            },
            "configOverride": {
              "type": "string",
              "description": "Allows to override default Clickhouse config via override.xml",
              "default": ""
            }
          }
        }
      }
    },
    "tabix": {
      "type": "object",
      "description": "Web interface for ClickHouse in the Tabix project",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable Tabix",
          "default": false
        },
        "replicas": {
          "type": "string",
          "description": "The instance number of Tabix",
          "default": "1"
        },
        "updateStrategy": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["Recreate", "RollingUpdate"],
              "default": "RollingUpdate"
            },
            "maxSurge": {
              "type": ["integer", "string"],
              "default": 3
            },
            "maxUnavailable": {
              "type": ["integer", "string"],
              "default": 1
            }
          }
        },
        "image": {
          "type": "string",
          "description": "Docker image name",
          "default": "spoonest/clickhouse-tabix-web-client"
        },
        "imageVersion": {
          "type": "string",
          "description": "Docker image version",
          "default": "stable"
        },
        "imagePullPolicy": {
          "type": "string",
          "enum": ["Always", "Never", "IfNotPresent"],
          "default": "IfNotPresent"
        },
        "imagePullSecrets": {
          "type": "array",
          "description": "ImagePullSecrets is an optional list of references to secrets",
          "items": {
            "type": "object"
          }
        },
        "livenessProbe": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "initialDelaySeconds": {
              "type": ["string", "integer"],
              "default": "30"
            },
            "periodSeconds": {
              "type": ["string", "integer"],
              "default": "30"
            },
            "timeoutSeconds": {
              "type": ["string", "integer"],
              "default": "5"
            },
            "failureThreshold": {
              "type": ["string", "integer"],
              "default": "3"
            },
            "successThreshold": {
              "type": ["string", "integer"],
              "default": "1"
            }
          }
        },
        "readinessProbe": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "initialDelaySeconds": {
              "type": ["string", "integer"],
              "default": "30"
            },
            "periodSeconds": {
              "type": ["string", "integer"],
              "default": "30"
            },
            "timeoutSeconds": {
              "type": ["string", "integer"],
              "default": "5"
            },
            "failureThreshold": {
              "type": ["string", "integer"],
              "default": "3"
            },
            "successThreshold": {
              "type": ["string", "integer"],
              "default": "1"
            }
          }
        },
        "security": {
          "type": "object",
          "properties": {
            "user": {
              "type": "string",
              "default": "admin"
            },
            "password": {
              "type": "string",
              "default": "admin"
            }
          }
        },
        "automaticConnection": {
          "type": "object",
          "properties": {
            "chName": {
              "type": "string"
            },
            "chHost": {
              "type": "string"
            },
            "chLogin": {
              "type": "string"
            },
            "chPassword": {
              "type": "string"
            },
            "chParams": {
              "type": "string"
            }
          }
        },
        "ingress": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "host": {
              "type": "string"
            },
            "path": {
              "type": "string",
              "default": "/"
            },
            "tls": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "hosts": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "secretName": {
                  "type": "string"
                }
              }
            }
          }
        },
        "resources": {
          "type": "object",
          "description": "The resource limits and requests used by tabix",
          "additionalProperties": true
        },
        "podAnnotations": {
          "type": ["object", "null"],
          "description": "Pod annotations",
          "additionalProperties": {
            "type": "string"
          }
        },
        "podLabels": {
          "type": ["object", "null"],
          "description": "Additional Labels",
          "additionalProperties": {
            "type": "string"
          }
        },
        "volumes": {
          "type": "array",
          "description": "Additional Volumes",
          "items": {
            "type": "object"
          }
        },
        "volumeMounts": {
          "type": "array",
          "description": "Additional Volume Mounts",
          "items": {
            "type": "object"
          }
        }
      }
    }
  },
  "additionalProperties": true
}


